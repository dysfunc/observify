"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Observify=function(i){var r={}.toString,n=[].slice,o={},u={},f={},t=["Array","Boolean","Date","Error","Function","Object","RegExp","String"].reduce(function(e,r){return e["[object "+r+"]"]=r.toLowerCase(),e},{}),l=function(e){return null===e?String(e):t[r.call(e)]||"object"},y=function(e,r){var t=Object.getOwnPropertyDescriptor(e,r);return!t||t&&t.writable},c=function(e){return v(e)[e.split(".").pop()]},a=function e(r,t,n,o){if("object"===l(t))for(var i in t)"object"===l(t[i])?e(r+"."+i,t[i],n,o):o?j(u,r+"."+i,n):d(u,b(r+"."+i),n);o?j(u,r,n):d(u,b(r),n)},s=function e(r){var t=Object.keys(r),n=!0,o=!1,i=void 0;try{for(var u,f=t[Symbol.iterator]();!(n=(u=f.next()).done);n=!0){var c=u.value,a=r[c];"object"===l(a)?e(a):Object.defineProperty(r,c,{enumerable:!0,writable:!1,value:a})}}catch(e){o=!0,i=e}finally{try{!n&&f.return&&f.return()}finally{if(o)throw i}}return r},p=function(e){var r=Object.keys(e),t=!0,n=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var f=i.value,c=y(e,f),a=e[f];"object"===l(a)?s(a):c||(delete e[f],e[f]=a)}}catch(e){n=!0,o=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw o}}return e},v=function(e){var r=e.split(".");return 1<r.length?r.slice(0,-1).reduce(function(e,r){return e[r]},i):i},b=function(e){var r=c(e);return f[e]={eventName:e,prevValue:r instanceof Array?r.slice():r},e},d=function(e,r,t){return e[r]?e[r].push(t):e[r]=[t],i},j=function(t,n,o){return t[n]&&void 0===o&&delete t[n],t[n]&&(t[n].forEach(function(e,r){e===o&&t[n].splice(r,1)}),t[n].length||delete t[n]),i};i.lock=function(e){if(!e)return s(i);var r=e.split(".").pop(),t=v(e),n=t[r];return Object.defineProperty(t,r,{enumerable:!0,writable:!1,value:n}),"object"===(void 0===n?"undefined":_typeof(n))&&s(n),i},i.unlock=function(e){if(!e)return p(i);var r=e.split(".").pop(),t=v(e),n=t[r];return y(t,r)||(delete t[r],t[r]=n,"object"===l(n)&&p(n)),i},i.listen=function(e,r){return a(e,c(e),r)},i.unlisten=function(e,r){return a(e,c(e),r,!0)},i.on=function(e,r){return d(o,e,r)},i.off=function(e,r){return j(o,e,r)},i.trigger=function(e){var r=this,t=n.call(arguments,1);return o[e]&&o[e].forEach(function(e){return e.apply(r,t)}),this},["on","off","listen","unlisten","trigger","lock","unlock"].forEach(function(e){Object.defineProperty(i,e,{enumerable:!1,writable:!1})});var h=function(r,t,n){var o=f[r];if(o){var e=o.eventName;u[e]&&(function r(t,n){if(null==t||null==n)return t===n;if(t.constructor!==n.constructor)return!1;if(t instanceof Function||t instanceof RegExp)return t===n;if(t===n||t.valueOf()===n.valueOf())return!0;if(Array.isArray(t)&&t.length!==n.length)return!1;if(t instanceof Date)return!1;if(!(t instanceof Object&&n instanceof Object))return!1;var o=Object.keys(t);return Object.keys(n).every(function(e){return-1!==o.indexOf(e)})&&o.every(function(e){return r(t[e],n[e])})}(t,o.prevValue)||u[e].forEach(function(e){return e.call(n,t,o.prevValue,r)})),o.prevValue=t instanceof Array?t.slice():t}return!0},O={get:function(r,t){var e=r[t];if("function"===l(e)&&"array"===l(r)){var n=this;return function(){var e=Array.prototype[t].apply(r,arguments);return h(n.ref,r,n),e}}var o=this.ref?this.ref+"."+t.toString():t,i=Object.assign({},O,{ref:o});return"object"===(void 0===e?"undefined":_typeof(e))&&null!==e?new Proxy(e,i):e},set:function(e,r,t){var n=y(e,r),o=this.ref?this.ref+"."+r.toString():r;return n?(e[r]=t,h(o,t,this),!0):e[r]}};return new Proxy(i,O)};"object"!==("undefined"==typeof exports?"undefined":_typeof(exports))&&"function"==typeof define&&define.amd?define([],Observify):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=Observify:"undefined"!==window&&(window.Observify=Observify);