"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Observify=function(i){var t={}.toString,n=[].slice,o={},u={},f={},r=["Array","Boolean","Date","Error","Function","Object","RegExp","String"].reduce(function(e,t){return e["[object "+t+"]"]=t.toLowerCase(),e},{}),l=function(e){return null===e?String(e):r[t.call(e)]||"object"},y=function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!r||r&&r.writable},c=function(e){return b(e)[e.split(".").pop()]},a=function e(t,r,n,o){if("object"===l(r))for(var i in r)"object"===l(r[i])?e(t+"."+i,r[i],n,o):o?h(u,t+"."+i,n):d(u,v(t+"."+i),n);o?h(u,t,n):d(u,v(t),n)},p=function e(t){var r=Object.keys(t),n=!0,o=!1,i=void 0;try{for(var u,f=r[Symbol.iterator]();!(n=(u=f.next()).done);n=!0){var c=u.value,a=t[c];"object"===l(a)?e(a):Object.defineProperty(t,c,{enumerable:!0,writable:!1,value:a})}}catch(e){o=!0,i=e}finally{try{!n&&f.return&&f.return()}finally{if(o)throw i}}return t},s=function(e){var t=Object.keys(e),r=!0,n=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var f=i.value,c=y(e,f),a=e[f];"object"===l(a)?p(a):c||(delete e[f],e[f]=a)}}catch(e){n=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw o}}return e},b=function(e){var t=e.split(".");return 1<t.length?t.slice(0,-1).reduce(function(e,t){return e[t]},i):i},v=function(e){var t=c(e);return f[e]={eventName:e,prevValue:t instanceof Array?t.slice():t},e},d=function(e,t,r){return e[t]?e[t].push(r):e[t]=[r],i},h=function(r,n,o){return r[n]&&void 0===o&&delete r[n],r[n]&&(r[n].forEach(function(e,t){e===o&&r[n].splice(t,1)}),r[n].length||delete r[n]),i};i.lock=function(e){if(!e)return p(i);var t=e.split(".").pop(),r=b(e),n=r[t];return Object.defineProperty(r,t,{enumerable:!0,writable:!1,value:n}),"object"===(void 0===n?"undefined":_typeof(n))&&p(n),i},i.unlock=function(e){if(!e)return s(i);var t=e.split(".").pop(),r=b(e),n=r[t];return y(r,t)||(delete r[t],r[t]=n,"object"===l(n)&&s(n)),i},i.listen=function(e,t){return a(e,c(e),t)},i.unlisten=function(e,t){return a(e,c(e),t,!0)},i.on=function(e,t){return d(o,e,t)},i.off=function(e,t){return h(o,e,t)},i.trigger=function(e){var t=this,r=n.call(arguments,1);return o[e]&&o[e].forEach(function(e){return e.apply(t,r)}),this},["on","off","listen","unlisten","trigger","lock","unlock"].forEach(function(e){Object.defineProperty(i,e,{enumerable:!1,writable:!1})});var j=function(t,r,n){var o=f[t];if(o){var i=o.eventName;u[i]&&u[i].forEach(function(e){return e.call(n,r,o.prevValue,t,i)}),f[t].prevValue=r instanceof Array?r.slice():r}return!0},m={get:function(e,t){var r=e[t];if("function"==typeof r&&e instanceof Array)return j(this.ref,e,this),function(){return Array.prototype[t].apply(e,arguments)};var n=this.ref?this.ref+"."+t:t,o=Object.assign({},m,{ref:n});return"object"===(void 0===r?"undefined":_typeof(r))&&null!==r?new Proxy(r,o):r},set:function(e,t,r){var n=y(e,t),o=this.ref?this.ref+"."+t:t;return n?(j(o,r,this),e[t]!==r&&(e[t]=r),!0):e[t]}};return new Proxy(i,m)};"object"!==("undefined"==typeof exports?"undefined":_typeof(exports))&&"function"==typeof define&&define.amd?define([],Observify):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=Observify:"undefined"!==window&&(window.Observify=Observify);