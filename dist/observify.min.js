"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Observify=function(u){var n={}.toString,t=[].slice,o={},f={},i={},p=[],c=["on","off","listen","unlisten","trigger","lock","unlock"],r=["Array","Boolean","Date","Error","Function","Number","Object","RegExp","String"].reduce(function(e,n){return e["[object "+n+"]"]=n.toLowerCase(),e},{}),v=function(e){return null===e?String(e):r[n.call(e)]||"object"},b=function(e){return"CSSStyleDeclaration"===e.constructor.name},d=function(e){return!p.includes(e)},l=function(e){return h(e)[e.split(".").pop()]},a=function e(n,r,t,o){if("object"===v(r))for(var i in r)"object"===v(r[i])?e(n+"."+i,r[i],t,o):o?O(f,n+"."+i,t):g(f,j(n+"."+i),t);o?O(f,n,t):g(f,j(n),t)},s=function e(n,r){var t=Object.keys(n),o=!0,i=!1,u=void 0;try{for(var f,c=t[Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var l=f.value,a=r&&r.length?r+"."+l:l,s=d(a),y=n[l];"object"===v(y)?e(y,a):s&&(p.push(a),b(n)||Object.defineProperty(n,l,{configurable:!0,enumerable:!0,writable:!1,value:y}))}}catch(e){i=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw u}}return n},y=function e(n,r){var t=Object.keys(n),o=!0,i=!1,u=void 0;try{for(var f,c=t[Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var l=f.value,a=r&&r.length?r+"."+l:l,s=d(a),y=n[l];"object"===v(y)?e(y,a):s||(p.splice(p.indexOf(a),1),b(y)||(delete n[l],n[l]=y))}}catch(e){i=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw u}}return n},h=function(e){var n=e.split(".");return 1<n.length?n.slice(0,-1).reduce(function(e,n){return e[n]},u):u},j=function(e){var n=l(e);return i[e]={eventName:e,prevValue:n instanceof Array?n.slice():n},e},g=function(e,n,r){return e[n]?e[n].push(r):e[n]=[r],u},O=function(r,t,o){return r[t]&&void 0===o&&delete r[t],r[t]&&(r[t].forEach(function(e,n){e===o&&r[t].splice(n,1)}),r[t].length||delete r[t]),u};u.lock=function(e){if(!e)return s(u,e);var n=e.split(".").pop(),r=h(e),t=r[n];return d(e)&&(p.push(e),Object.defineProperty(r,n,{configurable:!0,enumerable:!0,writable:!1,value:t}),"object"===(void 0===t?"undefined":_typeof(t))&&s(t,e)),u},u.unlock=function(e){if(!e)return y(u,e);var n=e.split(".").pop(),r=h(e),t=r[n];return d(e)||(p.splice(p.indexOf(e),1),b(t)||(delete r[n],r[n]=t),"object"===v(t)&&y(t,e)),u},u.listen=function(e,n){return a(e,l(e),n)},u.unlisten=function(e,n){return a(e,l(e),n,!0)},u.on=function(e,n){return g(o,e,n)},u.off=function(e,n){return O(o,e,n)},u.trigger=function(e){var n=this,r=t.call(arguments,1);return o[e]&&o[e].forEach(function(e){return e.apply(n,r)}),this},c.forEach(function(e){Object.defineProperty(u,e,{enumerable:!1,writable:!1})});var m=function(n,r,t){var o=i[n];if(o){var e=o.eventName;f[e]&&(function n(r,t){if(null==r||null==t)return r===t;if(r.constructor!==t.constructor)return!1;if(r instanceof Function||r instanceof RegExp)return r===t;if(r===t||r.valueOf()===t.valueOf())return!0;if(Array.isArray(r)&&r.length!==t.length)return!1;if(r instanceof Date)return!1;if(!(r instanceof Object&&t instanceof Object))return!1;var o=Object.keys(r);return Object.keys(t).every(function(e){return-1!==o.indexOf(e)})&&o.every(function(e){return n(r[e],t[e])})}(r,o.prevValue)||f[e].forEach(function(e){return e.call(t,r,o.prevValue,n)})),o.prevValue=r instanceof Array?r.slice():r}return!0},S={get:function(n,r){var e=n[r];if("function"===v(e)){if("array"===v(n)){var t=this;return function(){var e=Array.prototype[r].apply(n,arguments);return m(t.ref,n,t),e}}if(!c.includes(r))return e.bind(u)}var o=this.ref?this.ref+"."+r.toString():r,i=Object.assign({},S,{ref:o});return"object"===(void 0===e?"undefined":_typeof(e))&&null!==e?new Proxy(e,i):e},set:function(e,n,r){var t=this.ref?this.ref+"."+n.toString():n;return d(t)&&(e[n]=r,m(t,r,u)),!0}};return new Proxy(u,S)};"object"!==("undefined"==typeof exports?"undefined":_typeof(exports))&&"function"==typeof define&&define.amd?define([],Observify):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=Observify:"undefined"!==window&&(window.Observify=Observify);